(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,a){"use strict";a.r(t);var i=a(3),n=a.n(i),l=a(153),o=a(6),r=a(9),c=a(2),s=a(154),u=Object(c.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(c.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),d=a(4),m=a(152),g=a(1),b=a(10),h=a(7),p=a(13),v=a(155),f=Object(c.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(c.createElement)(s.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"}));const R=["image"];function E({temporaryURL:e,attributes:{url:t="",alt:a,align:i,id:n,width:l,height:s,caption:u},setAttributes:m,isSelected:b,onCloseModal:h,onSelectImage:E,onSelectURL:O,onUploadError:w,containerRef:j,context:_,clientId:k}){var y;const S=Object(c.useRef)(),{allowResize:U=!0}=(Object(c.useRef)(),_),{toggleSelection:I}=Object(r.useDispatch)(d.store),{multiImageSelection:L}=Object(r.useSelect)(e=>{const{getMultiSelectedBlockClientIds:t,getBlockName:a}=e(d.store),i=t();return{multiImageSelection:i.length&&i.every(e=>"uagb/image"===a(e))}},[n,b]),{imageEditing:x,maxWidth:B}=Object(r.useSelect)(e=>{const{getSettings:t}=e(d.store),{imageEditing:a,maxWidth:i}=t();return{imageEditing:a,maxWidth:i}},[k]),C=Object(p.useViewportMatch)("medium"),H=["wide","full"].includes(i),[{loadedNaturalWidth:T,loadedNaturalHeight:z},P]=Object(c.useState)({}),[N,W]=Object(c.useState)(!1),M=function(e,t){const[a,i]=Object(c.useState)();function n(){i(e.current.clientWidth)}return Object(c.useEffect)(n,t),Object(c.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),a}(j,[i]),F=U&&!(H&&C),{naturalWidth:A,naturalHeight:D}=Object(c.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=S.current)||void 0===e?void 0:e.naturalWidth)||T||void 0,naturalHeight:(null===(t=S.current)||void 0===t?void 0:t.naturalHeight)||z||void 0}},[T,z,null===(y=S.current)||void 0===y?void 0:y.complete]),V=Object(v.getFilename)(t);let G;G=a||(V?Object(g.sprintf)(
/* translators: %s: file name */
Object(g.__)("This image has an empty alt attribute; its file name is %s"),V):Object(g.__)("This image has an empty alt attribute"));let J,q,K=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:G,onError:()=>onImageError(),onLoad:e=>{var t,a;P({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(a=e.target)||void 0===a?void 0:a.naturalHeight})},ref:S}),e&&React.createElement(o.Spinner,null));if(M&&A&&D){const e=A>M,t=D/A;J=e?M:A,q=e?M*t:D}const Q=n&&A&&D&&x,X=!L&&Q&&!N;if(Q&&N)K=React.createElement(d.__experimentalImageEditor,{url:t,width:l,height:s,clientWidth:M,naturalHeight:D,naturalWidth:A});else if(F&&J){const e=l||J,t=s||q,a=A/D,n=A<D?20:20*a,r=D<A?20:20/a,c=2.5*B;let u=!1,d=!1;"center"===i?(u=!0,d=!0):Object(g.isRTL)()?"left"===i?u=!0:d=!0:"right"===i?d=!0:u=!0,K=React.createElement(o.ResizableBox,{size:{width:l||"auto",height:s||"auto"},showHandle:b,minWidth:n,maxWidth:c,minHeight:r,maxHeight:c/a,lockAspectRatio:!0,enable:{top:!1,right:u,bottom:!0,left:d},onResizeStart:function(){I(!1)},onResizeStop:(a,i,n,l)=>{I(!0),m({width:Math.abs(parseInt(e+l.width,10)),height:Math.abs(parseInt(t+l.height,10))})}},K)}else K=React.createElement("div",{style:{width:l,height:s}},K);const Y=React.createElement(React.Fragment,null,React.createElement(d.BlockControls,{group:"block"},X&&React.createElement(o.ToolbarButton,{onClick:()=>W(!0),icon:f,label:Object(g.__)("Crop")})),!L&&!N&&React.createElement(d.BlockControls,{group:"other"},React.createElement(d.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:R,accept:"image/*",onSelect:E,onSelectURL:O,onError:w,onCloseModal:h})));return React.createElement(React.Fragment,null,React.createElement(d.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:A,naturalHeight:D,clientWidth:M,onSaveImage:e=>m(e),isEditing:N,onFinishEditing:()=>W(!1)},!e&&Y,K))}function O({attributes:e,isSelected:t,setAttributes:a,captionRef:i}){const{caption:n,heading:l,layout:o,overlayContentPosition:r,seperatorStyle:s,seperatorPosition:u}=e,m=Object(c.useRef)();Object(c.useEffect)(()=>{m.current=l},[n]);const b=React.createElement(React.Fragment,null,(!d.RichText.isEmpty(l)||t)&&React.createElement(d.RichText,{ref:m,tagName:"h2",className:"uagb-image-heading","aria-label":Object(g.__)("Image overlay heading text"),placeholder:Object(g.__)("Add Heading"),value:l,onChange:e=>a({heading:e}),inlineToolbar:!0})),h=React.createElement(React.Fragment,null,(!d.RichText.isEmpty(n)||t)&&React.createElement(d.RichText,{ref:i,tagName:"figcaption",className:"uagb-image-caption","aria-label":Object(g.__)("Image caption text"),placeholder:Object(g.__)("Add caption"),value:n,onChange:e=>a({caption:e}),inlineToolbar:!0})),p="none"!==s&&React.createElement("div",{className:"uagb-image-separator"});return React.createElement(React.Fragment,null,"overlay"===o?React.createElement(React.Fragment,null,React.createElement("div",{className:"wp-block-uagb-image--layout-overlay__color-wrapper"}),React.createElement("div",{className:"wp-block-uagb-image--layout-overlay__inner "+r.replace(" ","-")},"before_title"===u&&p,b,"after_title"===u&&p,h,"after_sub_title"===u&&p)):h)}a(23),O.propTypes={},O.defaultProps={};const w=(e,t)=>t&&!e&&!Object(l.isBlobURL)(t),j=(e,t)=>e.hasOwnProperty("sizes")||e.hasOwnProperty("url")||e.hasOwnProperty("media_details")||e.hasOwnProperty("source_url")||void 0!==e[t];function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}const k=e=>{e=e.parentProps;const{attributes:t,setAttributes:a,className:i,isSelected:s,insertBlocksAfter:p,onReplace:v,context:f,clientId:k}=e,{block_id:y,layout:S,url:U,alt:I,caption:L,align:x,id:B,linkDestination:C,linkTarget:H,linkClass:T,rel:z,imageHoverEffect:P,href:N}=t,W=Object(b.a)(),{createNotice:M}=Object(r.useDispatch)("core/notices"),[F,A]=Object(c.useState)(),[D,V]=Object(c.useState)(),G=Object(c.useRef)();Object(c.useEffect)(()=>{G.current=I},[I]);const J=Object(c.useRef)();Object(c.useEffect)(()=>{J.current=L},[L]);const q=Object(c.useRef)(),{imageDefaultSize:K,mediaUpload:Q}=Object(r.useSelect)(e=>{const{getSettings:t}=e(d.store),{imageDefaultSize:a,mediaUpload:i}=t();return{imageDefaultSize:a,mediaUpload:i}},[]),{image:X}=Object(r.useSelect)(e=>{const{getMedia:t}=e(m.store);return{image:B&&s?t(B):null}},[B,s]);function Y(){(e=>{var t,a;return((null===(t=wp)||void 0===t||null===(a=t.media)||void 0===a?void 0:a.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&a({url:void 0,id:void 0})}function Z(e){M("error",e,{type:"snackbar"})}function $(e){var i,n,o,r,c;if(!e||!e.url)return void a({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(l.isBlobURL)(e.url))return void A(e.url);A();let s,u=((e,t)=>{var a,i,n;const{alt:l,id:o,link:r,caption:c,url:s}=e,u={alt:l,id:o,link:r,caption:c,url:s},d=(null==e||null===(a=e.sizes[t])||void 0===a?void 0:a.url)||(null==e||null===(i=e.media_details)||void 0===i||null===(n=i.sizes[t])||void 0===n?void 0:n.source_url);return d&&(u.url=d),u})(e,K);J.current&&!u.caption&&(u={...u,alt:u.alt,id:u.id,link:u.link}),s=e.id&&e.id===B?{url:U}:{width:void 0,height:void 0,sizeSlug:j(e,K)?K:"full"};let d,m=t.linkDestination;if(!m)switch((null===(i=wp)||void 0===i||null===(n=i.media)||void 0===n||null===(o=n.view)||void 0===o||null===(r=o.settings)||void 0===r||null===(c=r.defaultProps)||void 0===c?void 0:c.link)||"none"){case"file":case"media":m="media";break;case"post":case"attachment":m="attachment";break;case"custom":m="custom";break;case"none":m="none"}switch(m){case"media":d=e.url;break;case"attachment":d=e.link}u.href=d,a({...u,...s,linkDestination:m})}function ee(e){e!==U&&a({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:K})}let te=((e,t)=>!e&&Object(l.isBlobURL)(t))(B,U);Object(c.useEffect)(()=>{if(!te)return;const e=getBlobByURL(U);e&&Q({filesList:[e],onFileChange:([e])=>{$(e)},allowedTypes:R,onError:e=>{te=!1,M("error",e,{type:"snackbar"}),a({src:void 0,id:void 0,url:void 0})}})},[]),Object(c.useEffect)(()=>{te?A(U):Object(l.revokeBlobURL)(F)},[te,U]);const ae=w(B,U)?U:void 0,ie=!!U&&React.createElement("img",{alt:Object(g.__)("Edit image"),title:Object(g.__)("Edit image"),className:"edit-image-preview",src:U});Object(c.useEffect)(()=>{w(B,U)&&s&&!D&&window.fetch(U).then(e=>e.blob()).then(e=>V(e)).catch(()=>{})},[B,U,s,D]);const ne=Object(d.useBlockProps)({ref:q});return React.createElement(React.Fragment,null,React.createElement(d.BlockControls,{group:"block"},React.createElement(d.BlockAlignmentControl,{value:x,onChange:function(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};a({...t,align:e})}}),React.createElement(d.__experimentalImageURLInputUI,{url:N||"",onChangeUrl:function(e){a(e)},linkDestination:C,mediaUrl:X&&X.source_url||U,mediaLink:X&&X.link,linkTarget:H,linkClass:T,rel:z}),D&&React.createElement(o.ToolbarButton,{onClick:function(){Q({filesList:[D],onFileChange([e]){$(e),Object(l.isBlobURL)(null==e?void 0:e.url)||(V(),M("success",Object(g.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:R,onError(e){M("error",e,{type:"snackbar"})}})},icon:u,label:Object(g.__)("Upload external image")})),React.createElement("figure",_({},ne,{className:n()(i,"uagb-editor-preview-mode-"+W.toLowerCase(),"uagb-block-"+y,"wp-block-uagb-image--layout-"+S,"wp-block-uagb-image--effect-"+P,x?"wp-block-uagb-image--align-"+x:"")}),(F||U)&&React.createElement(React.Fragment,null,React.createElement(E,{temporaryURL:F,attributes:t,setAttributes:a,isSelected:s,insertBlocksAfter:p,onReplace:v,onSelectImage:$,onSelectURL:ee,onUploadError:Z,containerRef:q,context:f,clientId:k,onCloseModal:Y,onImageLoadError:function(e=!1){e||a({url:void 0,id:void 0})}}),React.createElement(O,{captionRef:J,attributes:t,setAttributes:a,isSelected:s})),React.createElement(d.MediaPlaceholder,{icon:React.createElement(d.BlockIcon,{icon:h.a.post_masonry}),labels:{title:Object(g.__)("Advanced Image","ultimate-addons-for-gutenberg"),instructions:Object(g.__)("Upload an image file, pick one from your media library, or add one with a URL.","ultimate-addons-for-gutenberg")},onSelect:$,onSelectURL:ee,onError:Z,onClose:Y,accept:"image/*",allowedTypes:R,value:{id:B,src:ae},mediaPreview:ie,disableMediaButtons:F||U})))};k.propTypes={},k.defaultProps={},t.default=k}}]);