(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,a){"use strict";a.r(t);var i=a(3),n=a.n(i),o=a(152),l=a(6),c=a(9),r=a(2),s=a(153),d=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),u=a(4),m=a(1),g=a(10),h=a(7),b=a(13),p=a(155),v=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"}));const f=["image"];function R({temporaryURL:e,attributes:{url:t="",alt:a,align:i,id:n,width:o,height:s,caption:d},setAttributes:g,isSelected:h,onCloseModal:R,onSelectImage:E,onSelectURL:O,onUploadError:w,containerRef:j,context:k,clientId:_}){var S;const y=Object(r.useRef)(),B=Object(r.useRef)(),{allowResize:L=!0}=k,{toggleSelection:U}=Object(c.useDispatch)(u.store),{multiImageSelection:I}=Object(c.useSelect)(e=>{const{getMultiSelectedBlockClientIds:t,getBlockName:a}=e(u.store),i=t();return{multiImageSelection:i.length&&i.every(e=>"uagb/image"===a(e))}},[n,h]),{imageEditing:x,maxWidth:H}=Object(c.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageEditing:a,maxWidth:i}=t();return{imageEditing:a,maxWidth:i}},[_]),C=Object(b.useViewportMatch)("medium"),z=["wide","full"].includes(i),[{loadedNaturalWidth:W,loadedNaturalHeight:P},T]=Object(r.useState)({}),[M,N]=Object(r.useState)(!1),A=function(e,t){const[a,i]=Object(r.useState)();function n(){i(e.current.clientWidth)}return Object(r.useEffect)(n,t),Object(r.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),a}(j,[i]),F=L&&!(z&&C),{naturalWidth:V,naturalHeight:D}=Object(r.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=y.current)||void 0===e?void 0:e.naturalWidth)||W||void 0,naturalHeight:(null===(t=y.current)||void 0===t?void 0:t.naturalHeight)||P||void 0}},[W,P,null===(S=y.current)||void 0===S?void 0:S.complete]),G=Object(p.getFilename)(t);let J;J=a||(G?Object(m.sprintf)(
/* translators: %s: file name */
Object(m.__)("This image has an empty alt attribute; its file name is %s"),G):Object(m.__)("This image has an empty alt attribute"));let q,K,Q=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:J,onError:()=>onImageError(),onLoad:e=>{var t,a;T({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(a=e.target)||void 0===a?void 0:a.naturalHeight})},ref:y}),e&&React.createElement(l.Spinner,null));if(A&&V&&D){const e=V>A,t=D/V;q=e?A:V,K=e?A*t:D}const X=n&&V&&D&&x,Y=!I&&X&&!M;if(X&&M)Q=React.createElement(u.__experimentalImageEditor,{url:t,width:o,height:s,clientWidth:A,naturalHeight:D,naturalWidth:V});else if(F&&q){const e=o||q,t=s||K,a=V/D,n=V<D?20:20*a,c=D<V?20:20/a,r=2.5*H;let d=!1,u=!1;"center"===i?(d=!0,u=!0):Object(m.isRTL)()?"left"===i?d=!0:u=!0:"right"===i?u=!0:d=!0,Q=React.createElement(l.ResizableBox,{size:{width:o||"auto",height:s||"auto"},showHandle:h,minWidth:n,maxWidth:r,minHeight:c,maxHeight:r/a,lockAspectRatio:!0,enable:{top:!1,right:d,bottom:!0,left:u},onResizeStart:function(){U(!1)},onResizeStop:(a,i,n,o)=>{U(!0),g({width:parseInt(e+o.width,10),height:parseInt(t+o.height,10)})}},Q)}else Q=React.createElement("div",{style:{width:o,height:s}},Q);const Z=React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},Y&&React.createElement(l.ToolbarButton,{onClick:()=>N(!0),icon:v,label:Object(m.__)("Crop")})),!I&&!M&&React.createElement(u.BlockControls,{group:"other"},React.createElement(u.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:f,accept:"image/*",onSelect:E,onSelectURL:O,onError:w,onCloseModal:R})));return React.createElement(React.Fragment,null,React.createElement(u.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:V,naturalHeight:D,clientWidth:A,onSaveImage:e=>g(e),isEditing:M,onFinishEditing:()=>N(!1)},!e&&Z,Q,(!u.RichText.isEmpty(d)||h)&&React.createElement(u.RichText,{ref:B,tagName:"figcaption","aria-label":Object(m.__)("Image caption text"),placeholder:Object(m.__)("Add caption"),value:d,onChange:e=>g({caption:e}),inlineToolbar:!0})))}const E=(e,t)=>t&&!e&&!Object(o.isBlobURL)(t);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}const w=e=>{e=e.parentProps;const{attributes:t,setAttributes:a,className:i,isSelected:s,insertBlocksAfter:b,onReplace:p,context:v,clientId:w}=e,{block_id:j,url:k,alt:_,caption:S,align:y,id:B}=t,L=Object(g.a)(),{createNotice:U}=Object(c.useDispatch)("core/notices"),[I,x]=Object(r.useState)(),[H,C]=Object(r.useState)(),z=Object(r.useRef)();Object(r.useEffect)(()=>{z.current=_},[_]);const W=Object(r.useRef)();Object(r.useEffect)(()=>{W.current=S},[S]);const P=Object(r.useRef)(),{imageDefaultSize:T,mediaUpload:M}=Object(c.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageDefaultSize:a,mediaUpload:i}=t();return{imageDefaultSize:a,mediaUpload:i}},[]);function N(){(e=>{var t,a;return((null===(t=wp)||void 0===t||null===(a=t.media)||void 0===a?void 0:a.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&a({url:void 0,id:void 0})}function A(e){U("error",e,{type:"snackbar"})}function F(e){var i,n,l,c,r;if(!e||!e.url)return void a({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(o.isBlobURL)(e.url))return void x(e.url);x();let s,d=((e,t)=>{const{alt:a,id:i,link:n,caption:o}=e,l={alt:a,id:i,link:n,caption:o};return l.url=e.url,l})(e);var u,m;W.current&&!get(d,["caption"])&&(d=omit(d,["caption"])),s=e.id&&e.id===B?{url:k}:{width:void 0,height:void 0,sizeSlug:(u=e,m=T,u.hasOwnProperty("sizes")||u.hasOwnProperty("url")||u.hasOwnProperty("media_details")||u.hasOwnProperty("source_url")||void 0!==u[m]?T:"full")};let g,h=t.linkDestination;if(!h)switch((null===(i=wp)||void 0===i||null===(n=i.media)||void 0===n||null===(l=n.view)||void 0===l||null===(c=l.settings)||void 0===c||null===(r=c.defaultProps)||void 0===r?void 0:r.link)||"none"){case"file":case"media":h="media";break;case"post":case"attachment":h="attachment";break;case"custom":h="custom";break;case"none":h="none"}switch(h){case"media":g=e.url;break;case"attachment":g=e.link}d.href=g,a({...d,...s,linkDestination:h})}function V(e){e!==k&&a({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:T})}let D=((e,t)=>!e&&Object(o.isBlobURL)(t))(B,k);Object(r.useEffect)(()=>{if(!D)return;const e=getBlobByURL(k);e&&M({filesList:[e],onFileChange:([e])=>{F(e)},allowedTypes:f,onError:e=>{D=!1,U("error",e,{type:"snackbar"}),a({src:void 0,id:void 0,url:void 0})}})},[]),Object(r.useEffect)(()=>{D?x(k):Object(o.revokeBlobURL)(I)},[D,k]);const G=E(B,k)?k:void 0,J=!!k&&React.createElement("img",{alt:Object(m.__)("Edit image"),title:Object(m.__)("Edit image"),className:"edit-image-preview",src:k});Object(r.useEffect)(()=>{E(B,k)&&s&&!H&&window.fetch(k).then(e=>e.blob()).then(e=>C(e)).catch(()=>{})},[B,k,s,H]);const q=Object(u.useBlockProps)({ref:P});return React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},H&&React.createElement(l.ToolbarButton,{onClick:function(){M({filesList:[H],onFileChange([e]){F(e),Object(o.isBlobURL)(null==e?void 0:e.url)||(C(),U("success",Object(m.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:f,onError(e){U("error",e,{type:"snackbar"})}})},icon:d,label:Object(m.__)("Upload external image")})),React.createElement("figure",O({},q,{className:n()(i,"uagb-editor-preview-mode-"+L.toLowerCase(),"uagb-block-"+j,"wp-block-uagb-image-align-"+y)}),(I||k)&&React.createElement(R,{temporaryURL:I,attributes:t,setAttributes:a,isSelected:s,insertBlocksAfter:b,onReplace:p,onSelectImage:F,onSelectURL:V,onUploadError:A,containerRef:P,context:v,clientId:w,onCloseModal:N,onImageLoadError:function(e=!1){e||a({url:void 0,id:void 0})}}),!k&&React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:y,onChange:function(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};a({...t,align:e})}})),React.createElement(u.MediaPlaceholder,{icon:React.createElement(u.BlockIcon,{icon:h.a.post_masonry}),labels:{title:Object(m.__)("Advanced Image","ultimate-addons-for-gutenberg"),instructions:Object(m.__)("Upload an image file, pick one from your media library, or add one with a URL.","ultimate-addons-for-gutenberg")},onSelect:F,onSelectURL:V,onError:A,onClose:N,accept:"image/*",allowedTypes:f,value:{id:B,src:G},mediaPreview:J,disableMediaButtons:I||k})))};w.propTypes={},w.defaultProps={},t.default=w}}]);