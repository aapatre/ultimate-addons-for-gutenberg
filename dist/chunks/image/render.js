(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,a){"use strict";a.r(t);var i=a(3),n=a.n(i),o=a(153),l=a(6),c=a(9),r=a(2),s=a(154),d=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),u=a(4),m=a(1),g=a(10),h=a(7),b=a(13),p=a(155),v=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"})),f=a(152);const R=["image"];function O({temporaryURL:e,attributes:{url:t="",alt:a,align:i,id:n,width:o,height:s,caption:d},setAttributes:g,isSelected:h,onCloseModal:O,onSelectImage:E,onSelectURL:w,onUploadError:j,containerRef:k,context:S,clientId:_}){var y;const B=Object(r.useRef)(),I=Object(r.useRef)(),{allowResize:U=!0}=(Object(b.usePrevious)(t),S),{toggleSelection:L}=Object(c.useDispatch)(u.store),{multiImageSelection:C}=Object(c.useSelect)(e=>{const{getMedia:t}=e(f.store),{getMultiSelectedBlockClientIds:a,getBlockName:i}=e(u.store),o=a();return{image:n&&h?t(n):null,multiImageSelection:o.length&&o.every(e=>"core/image"===i(e))}},[n,h]),{imageEditing:x,maxWidth:H}=Object(c.useSelect)(e=>{const{getBlockRootClientId:t,getSettings:a,canInsertBlockType:i}=e(u.store),n=t(_),{imageEditing:o,imageSizes:l,maxWidth:c,mediaUpload:r}=a();return{imageEditing:o,imageSizes:l,maxWidth:c,mediaUpload:r,canInsertCover:i("core/cover",n)}},[_]),z=Object(b.useViewportMatch)("medium"),W=["wide","full"].includes(i),[{loadedNaturalWidth:P,loadedNaturalHeight:T},M]=Object(r.useState)({}),[N,A]=Object(r.useState)(!1),F=function(e,t){const[a,i]=Object(r.useState)();function n(){i(e.current.clientWidth)}return Object(r.useEffect)(n,t),Object(r.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),a}(k,[i]),V=U&&!(W&&z),{naturalWidth:D,naturalHeight:G}=Object(r.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=B.current)||void 0===e?void 0:e.naturalWidth)||P||void 0,naturalHeight:(null===(t=B.current)||void 0===t?void 0:t.naturalHeight)||T||void 0}},[P,T,null===(y=B.current)||void 0===y?void 0:y.complete]),J=Object(p.getFilename)(t);let q;q=a||(J?Object(m.sprintf)(
/* translators: %s: file name */
Object(m.__)("This image has an empty alt attribute; its file name is %s"),J):Object(m.__)("This image has an empty alt attribute"));let K,Q,X=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:q,onError:()=>onImageError(),onLoad:e=>{var t,a;M({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(a=e.target)||void 0===a?void 0:a.naturalHeight})},ref:B}),e&&React.createElement(l.Spinner,null));if(F&&D&&G){const e=D>F,t=G/D;K=e?F:D,Q=e?F*t:G}const Y=n&&D&&G&&x,Z=!C&&Y&&!N;if(Y&&N)X=React.createElement(u.__experimentalImageEditor,{url:t,width:o,height:s,clientWidth:F,naturalHeight:G,naturalWidth:D});else if(V&&K){const e=o||K,t=s||Q,a=D/G,n=D<G?20:20*a,c=G<D?20:20/a,r=2.5*H;let d=!1,u=!1;"center"===i?(d=!0,u=!0):Object(m.isRTL)()?"left"===i?d=!0:u=!0:"right"===i?u=!0:d=!0,X=React.createElement(l.ResizableBox,{size:{width:o||"auto",height:s||"auto"},showHandle:h,minWidth:n,maxWidth:r,minHeight:c,maxHeight:r/a,lockAspectRatio:!0,enable:{top:!1,right:d,bottom:!0,left:u},onResizeStart:function(){L(!1)},onResizeStop:(a,i,n,o)=>{L(!0),g({width:parseInt(e+o.width,10),height:parseInt(t+o.height,10)})}},X)}else X=React.createElement("div",{style:{width:o,height:s}},X);const $=React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},Z&&React.createElement(l.ToolbarButton,{onClick:()=>A(!0),icon:v,label:Object(m.__)("Crop")})),!C&&!N&&React.createElement(u.BlockControls,{group:"other"},React.createElement(u.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:R,accept:"image/*",onSelect:E,onSelectURL:w,onError:j,onCloseModal:O})));return React.createElement(React.Fragment,null,React.createElement(u.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:D,naturalHeight:G,clientWidth:F,onSaveImage:e=>g(e),isEditing:N,onFinishEditing:()=>A(!1)},!e&&$,X,(!u.RichText.isEmpty(d)||h)&&React.createElement(u.RichText,{ref:I,tagName:"figcaption","aria-label":Object(m.__)("Image caption text"),placeholder:Object(m.__)("Add caption"),value:d,onChange:e=>g({caption:e}),inlineToolbar:!0})))}const E=(e,t)=>t&&!e&&!Object(o.isBlobURL)(t);function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}const j=e=>{e=e.parentProps;const{attributes:t,setAttributes:a,className:i,isSelected:s,insertBlocksAfter:b,onReplace:p,context:v,clientId:f}=e,{block_id:j,url:k,alt:S,caption:_,align:y,id:B}=t,I=Object(g.a)(),{createNotice:U}=Object(c.useDispatch)("core/notices"),[L,C]=Object(r.useState)(),[x,H]=Object(r.useState)(),z=Object(r.useRef)();Object(r.useEffect)(()=>{z.current=S},[S]);const W=Object(r.useRef)();Object(r.useEffect)(()=>{W.current=_},[_]);const P=Object(r.useRef)(),{imageDefaultSize:T,mediaUpload:M}=Object(c.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageDefaultSize:a,mediaUpload:i}=t();return{imageDefaultSize:a,mediaUpload:i}},[]);function N(){(e=>{var t,a;return((null===(t=wp)||void 0===t||null===(a=t.media)||void 0===a?void 0:a.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&a({url:void 0,id:void 0})}function A(e){U("error",e,{type:"snackbar"})}function F(e){var i,n,l,c,r;if(!e||!e.url)return void a({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(o.isBlobURL)(e.url))return void C(e.url);C();let s,d=((e,t)=>{const{alt:a,id:i,link:n,caption:o}=e,l={alt:a,id:i,link:n,caption:o};return l.url=e.url,l})(e);var u,m;W.current&&!get(d,["caption"])&&(d=omit(d,["caption"])),s=e.id&&e.id===B?{url:k}:{width:void 0,height:void 0,sizeSlug:(u=e,m=T,u.hasOwnProperty("sizes")||u.hasOwnProperty("url")||u.hasOwnProperty("media_details")||u.hasOwnProperty("source_url")||void 0!==u[m]?T:"full")};let g,h=t.linkDestination;if(!h)switch((null===(i=wp)||void 0===i||null===(n=i.media)||void 0===n||null===(l=n.view)||void 0===l||null===(c=l.settings)||void 0===c||null===(r=c.defaultProps)||void 0===r?void 0:r.link)||"none"){case"file":case"media":h="media";break;case"post":case"attachment":h="attachment";break;case"custom":h="custom";break;case"none":h="none"}switch(h){case"media":g=e.url;break;case"attachment":g=e.link}d.href=g,a({...d,...s,linkDestination:h})}function V(e){e!==k&&a({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:T})}let D=((e,t)=>!e&&Object(o.isBlobURL)(t))(B,k);Object(r.useEffect)(()=>{if(!D)return;const e=getBlobByURL(k);e&&M({filesList:[e],onFileChange:([e])=>{F(e)},allowedTypes:R,onError:e=>{D=!1,U("error",e,{type:"snackbar"}),a({src:void 0,id:void 0,url:void 0})}})},[]),Object(r.useEffect)(()=>{D?C(k):Object(o.revokeBlobURL)(L)},[D,k]);const G=E(B,k)?k:void 0,J=!!k&&React.createElement("img",{alt:Object(m.__)("Edit image"),title:Object(m.__)("Edit image"),className:"edit-image-preview",src:k});Object(r.useEffect)(()=>{E(B,k)&&s&&!x&&window.fetch(k).then(e=>e.blob()).then(e=>H(e)).catch(()=>{})},[B,k,s,x]);const q=Object(u.useBlockProps)({ref:P});return React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},x&&React.createElement(l.ToolbarButton,{onClick:function(){M({filesList:[x],onFileChange([e]){F(e),Object(o.isBlobURL)(null==e?void 0:e.url)||(H(),U("success",Object(m.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:R,onError(e){U("error",e,{type:"snackbar"})}})},icon:d,label:Object(m.__)("Upload external image")})),React.createElement("figure",w({},q,{className:n()(i,"uagb-editor-preview-mode-"+I.toLowerCase(),"uagb-block-"+j,"wp-block-uagb-image-align-"+y)}),(L||k)&&React.createElement(O,{temporaryURL:L,attributes:t,setAttributes:a,isSelected:s,insertBlocksAfter:b,onReplace:p,onSelectImage:F,onSelectURL:V,onUploadError:A,containerRef:P,context:v,clientId:f,onCloseModal:N,onImageLoadError:function(e=!1){e||a({url:void 0,id:void 0})}}),!k&&React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:y,onChange:function(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};a({...t,align:e})}})),React.createElement(u.MediaPlaceholder,{icon:React.createElement(u.BlockIcon,{icon:h.a.post_masonry}),labels:{title:Object(m.__)("Advanced Image","ultimate-addons-for-gutenberg"),instructions:Object(m.__)("Upload an image file, pick one from your media library, or add one with a URL.","ultimate-addons-for-gutenberg")},onSelect:F,onSelectURL:V,onError:A,onClose:N,accept:"image/*",allowedTypes:R,value:{id:B,src:G},mediaPreview:J,disableMediaButtons:L||k})))};j.propTypes={},j.defaultProps={},t.default=j}}]);