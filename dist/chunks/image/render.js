(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),l=a(3),o=a.n(l),r=a(153),c=a(6),s=a(9),u=a(2),d=a(154),m=Object(u.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(u.createElement)(d.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),g=a(4),b=a(152),h=a(1),p=a(10),v=a(7),f=a(13),E=a(155),O=Object(u.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(u.createElement)(d.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"}));const w=["image"];function j({temporaryURL:e,attributes:{url:t="",alt:a,align:i,id:n,width:l,height:o},setAttributes:r,isSelected:d,onCloseModal:m,onSelectImage:b,onSelectURL:p,onUploadError:v,containerRef:j,context:_,clientId:R}){var k;const y=Object(u.useRef)(),{allowResize:S=!0}=_,{toggleSelection:U}=Object(s.useDispatch)(g.store),{multiImageSelection:L}=Object(s.useSelect)(e=>{const{getMultiSelectedBlockClientIds:t,getBlockName:a}=e(g.store),i=t();return{multiImageSelection:i.length&&i.every(e=>"uagb/image"===a(e))}},[n,d]),{imageEditing:x,maxWidth:B}=Object(s.useSelect)(e=>{const{getSettings:t}=e(g.store),{imageEditing:a,maxWidth:i}=t();return{imageEditing:a,maxWidth:i}},[R]),I=Object(f.useViewportMatch)("medium"),C=["wide","full"].includes(i),[{loadedNaturalWidth:H,loadedNaturalHeight:z},T]=Object(u.useState)({}),[N,P]=Object(u.useState)(!1),W=function(e,t){const[a,i]=Object(u.useState)();function n(){i(e.current.clientWidth)}return Object(u.useEffect)(n,t),Object(u.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),a}(j,[i]),M=S&&!(C&&I),{naturalWidth:F,naturalHeight:A}=Object(u.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=y.current)||void 0===e?void 0:e.naturalWidth)||H||void 0,naturalHeight:(null===(t=y.current)||void 0===t?void 0:t.naturalHeight)||z||void 0}},[H,z,null===(k=y.current)||void 0===k?void 0:k.complete]),D=Object(E.getFilename)(t);let V;V=a||(D?Object(h.sprintf)(
/* translators: %s: file name */
Object(h.__)("This image has an empty alt attribute; its file name is %s"),D):Object(h.__)("This image has an empty alt attribute"));let G,J,q=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:V,onLoad:e=>{var t,a;T({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(a=e.target)||void 0===a?void 0:a.naturalHeight})},ref:y}),e&&React.createElement(c.Spinner,null));if(W&&F&&A){const e=F>W,t=A/F;G=e?W:F,J=e?W*t:A}const K=n&&F&&A&&x,Q=!L&&K&&!N;if(K&&N)q=React.createElement(g.__experimentalImageEditor,{url:t,width:l,height:o,clientWidth:W,naturalHeight:A,naturalWidth:F});else if(M&&G){const e=l||G,t=o||J,a=F/A,n=F<A?20:20*a,s=A<F?20:20/a,u=2.5*B;let m=!1,g=!1;"center"===i?(m=!0,g=!0):Object(h.isRTL)()?"left"===i?m=!0:g=!0:"right"===i?g=!0:m=!0,q=React.createElement(c.ResizableBox,{size:{width:l||"auto",height:o||"auto"},showHandle:d,minWidth:n,maxWidth:u,minHeight:s,maxHeight:u/a,lockAspectRatio:!0,enable:{top:!1,right:m,bottom:!0,left:g},onResizeStart:function(){U(!1)},onResizeStop:(a,i,n,l)=>{U(!0),r({width:Math.abs(parseInt(e+l.width,10)),height:Math.abs(parseInt(t+l.height,10))})}},q)}else q=React.createElement("div",{style:{width:l,height:o}},q);const X=React.createElement(React.Fragment,null,React.createElement(g.BlockControls,{group:"block"},Q&&React.createElement(c.ToolbarButton,{onClick:()=>P(!0),icon:O,label:Object(h.__)("Crop")})),!L&&!N&&React.createElement(g.BlockControls,{group:"other"},React.createElement(g.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:w,accept:"image/*",onSelect:b,onSelectURL:p,onError:v,onCloseModal:m})));return React.createElement(React.Fragment,null,React.createElement(g.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:F,naturalHeight:A,clientWidth:W,onSaveImage:e=>r(e),isEditing:N,onFinishEditing:()=>P(!1)},!e&&X,q))}function _({attributes:e,isSelected:t,setAttributes:a,captionRef:l}){const{caption:o,heading:r,layout:c,overlayContentPosition:s,seperatorStyle:u,seperatorPosition:d}=e,m=Object(i.useRef)();Object(i.useEffect)(()=>{m.current=r},[o]);const b=n.a.createElement(n.a.Fragment,null,(!g.RichText.isEmpty(r)||t)&&n.a.createElement(g.RichText,{ref:m,tagName:"h2",className:"uagb-image-heading","aria-label":Object(h.__)("Image overlay heading text"),placeholder:Object(h.__)("Add Heading"),value:r,onChange:e=>a({heading:e}),inlineToolbar:!0})),p=n.a.createElement(n.a.Fragment,null,(!g.RichText.isEmpty(o)||t)&&n.a.createElement(g.RichText,{ref:l,tagName:"figcaption",className:"uagb-image-caption","aria-label":Object(h.__)("Image caption text"),placeholder:Object(h.__)("Add caption"),value:o,onChange:e=>a({caption:e}),inlineToolbar:!0})),v="none"!==u&&n.a.createElement("div",{className:"uagb-image-separator"});return n.a.createElement(n.a.Fragment,null,"overlay"===c?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"wp-block-uagb-image--layout-overlay__color-wrapper"}),n.a.createElement("div",{className:"wp-block-uagb-image--layout-overlay__inner "+s.replace(" ","-")},"before_title"===d&&v,b,"after_title"===d&&v,p,"after_sub_title"===d&&v)):p)}const R=(e,t)=>t&&!e&&!Object(r.isBlobURL)(t),k=(e,t)=>e.hasOwnProperty("sizes")||e.hasOwnProperty("url")||e.hasOwnProperty("media_details")||e.hasOwnProperty("source_url")||void 0!==e[t];function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}const S=e=>{const{attributes:t,setAttributes:a,className:l,isSelected:u,insertBlocksAfter:d,onReplace:f,context:E,clientId:O}=e.parentProps,{block_id:S,layout:U,url:L,alt:x,caption:B,align:I,id:C,linkTarget:H,linkClass:z,rel:T,imageHoverEffect:N,href:P,linkDestination:W}=t,M=Object(p.a)(),{createNotice:F}=Object(s.useDispatch)("core/notices"),[A,D]=Object(i.useState)(),[V,G]=Object(i.useState)(),J=Object(i.useRef)();Object(i.useEffect)(()=>{J.current=x},[x]);const q=Object(i.useRef)();Object(i.useEffect)(()=>{q.current=B},[B]);const K=Object(i.useRef)(),{imageDefaultSize:Q,mediaUpload:X}=Object(s.useSelect)(e=>{const{getSettings:t}=e(g.store),{imageDefaultSize:a,mediaUpload:i}=t();return{imageDefaultSize:a,mediaUpload:i}},[]),{image:Y}=Object(s.useSelect)(e=>{const{getMedia:t}=e(b.store);return{image:C&&u?t(C):null}},[C,u]);function Z(){(e=>{var t,a;return((null===(t=wp)||void 0===t||null===(a=t.media)||void 0===a?void 0:a.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&a({url:void 0,id:void 0})}function $(e){F("error",e,{type:"snackbar"})}function ee(e){var i,n,l,o,c;if(!e||!e.url)return void a({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(r.isBlobURL)(e.url))return void D(e.url);D();let s,u=((e,t)=>{var a,i,n;const{alt:l,id:o,link:r,caption:c,url:s}=e,u={alt:l,id:o,link:r,caption:c,url:s},d=(null==e||null===(a=e.sizes[t])||void 0===a?void 0:a.url)||(null==e||null===(i=e.media_details)||void 0===i||null===(n=i.sizes[t])||void 0===n?void 0:n.source_url);return d&&(u.url=d),u})(e,Q);q.current&&!u.caption&&(u={...u,alt:u.alt,id:u.id,link:u.link}),s=e.id&&e.id===C?{url:L}:{width:void 0,height:void 0,sizeSlug:k(e,Q)?Q:"full"};let d,m=t.linkDestination;if(!m)switch((null===(i=wp)||void 0===i||null===(n=i.media)||void 0===n||null===(l=n.view)||void 0===l||null===(o=l.settings)||void 0===o||null===(c=o.defaultProps)||void 0===c?void 0:c.link)||"none"){case"file":case"media":m="media";break;case"post":case"attachment":m="attachment";break;case"custom":m="custom";break;case"none":m="none"}switch(m){case"media":d=e.url;break;case"attachment":d=e.link}u.href=d,a({...u,...s,linkDestination:m})}function te(e){e!==L&&a({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:Q})}let ae=((e,t)=>!e&&Object(r.isBlobURL)(t))(C,L);Object(i.useEffect)(()=>{if(!ae)return;const e=Object(r.getBlobByURL)(L);e&&X({filesList:[e],onFileChange:([e])=>{ee(e)},allowedTypes:w,onError:e=>{ae=!1,F("error",e,{type:"snackbar"}),a({src:void 0,id:void 0,url:void 0})}})},[]),Object(i.useEffect)(()=>{ae?D(L):Object(r.revokeBlobURL)(A)},[ae,L]);const ie=R(C,L)?L:void 0,ne=!!L&&n.a.createElement("img",{alt:Object(h.__)("Edit image"),title:Object(h.__)("Edit image"),className:"edit-image-preview",src:L});Object(i.useEffect)(()=>{R(C,L)&&u&&!V&&window.fetch(L).then(e=>e.blob()).then(e=>G(e)).catch(()=>{})},[C,L,u,V]);const le=Object(g.useBlockProps)({ref:K});return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.BlockControls,{group:"block"},n.a.createElement(g.BlockAlignmentControl,{value:I,onChange:function(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};a({...t,align:e})}}),n.a.createElement(g.__experimentalImageURLInputUI,{url:P||"",onChangeUrl:function(e){a(e)},linkDestination:W,mediaUrl:Y&&Y.source_url||L,mediaLink:Y&&Y.link,linkTarget:H,linkClass:z,rel:T}),V&&n.a.createElement(c.ToolbarButton,{onClick:function(){X({filesList:[V],onFileChange([e]){ee(e),Object(r.isBlobURL)(null==e?void 0:e.url)||(G(),F("success",Object(h.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:w,onError(e){F("error",e,{type:"snackbar"})}})},icon:m,label:Object(h.__)("Upload external image")})),n.a.createElement("figure",y({},le,{className:o()(l,"uagb-editor-preview-mode-"+M.toLowerCase(),"uagb-block-"+S,"wp-block-uagb-image--layout-"+U,"wp-block-uagb-image--effect-"+N,I?"wp-block-uagb-image--align-"+I:"")}),(A||L)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(j,{temporaryURL:A,attributes:t,setAttributes:a,isSelected:u,insertBlocksAfter:d,onReplace:f,onSelectImage:ee,onSelectURL:te,onUploadError:$,containerRef:K,context:E,clientId:O,onCloseModal:Z,onImageLoadError:function(e=!1){e||a({url:void 0,id:void 0})}}),n.a.createElement(_,{captionRef:q,attributes:t,setAttributes:a,isSelected:u})),n.a.createElement(g.MediaPlaceholder,{icon:n.a.createElement(g.BlockIcon,{icon:v.a.post_masonry}),labels:{title:Object(h.__)("Advanced Image","ultimate-addons-for-gutenberg"),instructions:Object(h.__)("Upload an image file, pick one from your media library, or add one with a URL.","ultimate-addons-for-gutenberg")},onSelect:ee,onSelectURL:te,onError:$,onClose:Z,accept:"image/*",allowedTypes:w,value:{id:C,src:ie},mediaPreview:ne,disableMediaButtons:A||L})))};S.propTypes={},S.defaultProps={},t.default=S}}]);