(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,a){"use strict";a.r(t);var i=a(3),n=a.n(i),o=a(153),c=a(6),l=a(9),r=a(2),s=a(152),d=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),u=a(4),m=a(1),g=a(10),h=Object(r.createElement)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(r.createElement)(s.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"})),b=a(13),v=a(154),p=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"})),f=a(155);const R=["image"];function w({temporaryURL:e,attributes:{url:t="",alt:a,align:i,id:n,width:o,height:s,caption:d},setAttributes:g,isSelected:h,onCloseModal:w,onSelectImage:E,onSelectURL:O,onUploadError:j,containerRef:k,context:S,clientId:_}){var B;const y=Object(r.useRef)(),L=Object(r.useRef)(),{allowResize:I=!0}=(Object(b.usePrevious)(t),S),{toggleSelection:x}=Object(l.useDispatch)(u.store),{multiImageSelection:z}=Object(l.useSelect)(e=>{const{getMedia:t}=e(f.store),{getMultiSelectedBlockClientIds:a,getBlockName:i}=e(u.store),o=a();return{image:n&&h?t(n):null,multiImageSelection:o.length&&o.every(e=>"core/image"===i(e))}},[n,h]),{imageEditing:H,maxWidth:U}=Object(l.useSelect)(e=>{const{getBlockRootClientId:t,getSettings:a,canInsertBlockType:i}=e(u.store),n=t(_),{imageEditing:o,imageSizes:c,maxWidth:l,mediaUpload:r}=a();return{imageEditing:o,imageSizes:c,maxWidth:l,mediaUpload:r,canInsertCover:i("core/cover",n)}},[_]),C=Object(b.useViewportMatch)("medium"),P=["wide","full"].includes(i),[{loadedNaturalWidth:W,loadedNaturalHeight:M},T]=Object(r.useState)({}),[V,N]=Object(r.useState)(!1),F=function(e,t){const[a,i]=Object(r.useState)();function n(){i(e.current.clientWidth)}return Object(r.useEffect)(n,t),Object(r.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),a}(k,[i]),A=I&&!(P&&C),{naturalWidth:D,naturalHeight:G}=Object(r.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=y.current)||void 0===e?void 0:e.naturalWidth)||W||void 0,naturalHeight:(null===(t=y.current)||void 0===t?void 0:t.naturalHeight)||M||void 0}},[W,M,null===(B=y.current)||void 0===B?void 0:B.complete]),J=Object(v.getFilename)(t);let q;q=a||(J?Object(m.sprintf)(
/* translators: %s: file name */
Object(m.__)("This image has an empty alt attribute; its file name is %s"),J):Object(m.__)("This image has an empty alt attribute"));let K,Q,X=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:q,onError:()=>onImageError(),onLoad:e=>{var t,a;T({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(a=e.target)||void 0===a?void 0:a.naturalHeight})},ref:y}),e&&React.createElement(c.Spinner,null));if(F&&D&&G){const e=D>F,t=G/D;K=e?F:D,Q=e?F*t:G}const Y=n&&D&&G&&H,Z=!z&&Y&&!V;if(Y&&V)X=React.createElement(u.__experimentalImageEditor,{url:t,width:o,height:s,clientWidth:F,naturalHeight:G,naturalWidth:D});else if(A&&K){const e=o||K,t=s||Q,a=D/G,n=D<G?20:20*a,l=G<D?20:20/a,r=2.5*U;let d=!1,u=!1;"center"===i?(d=!0,u=!0):Object(m.isRTL)()?"left"===i?d=!0:u=!0:"right"===i?u=!0:d=!0,X=React.createElement(c.ResizableBox,{size:{width:o||"auto",height:s||"auto"},showHandle:h,minWidth:n,maxWidth:r,minHeight:l,maxHeight:r/a,lockAspectRatio:!0,enable:{top:!1,right:d,bottom:!0,left:u},onResizeStart:function(){x(!1)},onResizeStop:(a,i,n,o)=>{x(!0),g({width:parseInt(e+o.width,10),height:parseInt(t+o.height,10)})}},X)}else X=React.createElement("div",{style:{width:o,height:s}},X);const $=React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},Z&&React.createElement(c.ToolbarButton,{onClick:()=>N(!0),icon:p,label:Object(m.__)("Crop")})),!z&&!V&&React.createElement(u.BlockControls,{group:"other"},React.createElement(u.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:R,accept:"image/*",onSelect:E,onSelectURL:O,onError:j,onCloseModal:w})));return React.createElement(React.Fragment,null,React.createElement(u.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:D,naturalHeight:G,clientWidth:F,onSaveImage:e=>g(e),isEditing:V,onFinishEditing:()=>N(!1)},!e&&$,X,(!u.RichText.isEmpty(d)||h)&&React.createElement(u.RichText,{ref:L,tagName:"figcaption","aria-label":Object(m.__)("Image caption text"),placeholder:Object(m.__)("Add caption"),value:d,onChange:e=>g({caption:e}),inlineToolbar:!0})))}const E=(e,t)=>t&&!e&&!Object(o.isBlobURL)(t);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}const j=e=>{e=e.parentProps;const{attributes:t,setAttributes:a,className:i,isSelected:s,insertBlocksAfter:b,onReplace:v,context:p,clientId:f}=e,{block_id:j,url:k,alt:S,caption:_,align:B,id:y}=t,L=Object(g.a)(),{createNotice:I}=Object(l.useDispatch)("core/notices"),[x,z]=Object(r.useState)(),[H,U]=Object(r.useState)(),C=Object(r.useRef)();Object(r.useEffect)(()=>{C.current=S},[S]);const P=Object(r.useRef)();Object(r.useEffect)(()=>{P.current=_},[_]);const W=Object(r.useRef)(),{imageDefaultSize:M,mediaUpload:T}=Object(l.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageDefaultSize:a,mediaUpload:i}=t();return{imageDefaultSize:a,mediaUpload:i}},[]);function V(){(e=>{var t,a;return((null===(t=wp)||void 0===t||null===(a=t.media)||void 0===a?void 0:a.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&a({url:void 0,id:void 0})}function N(e){I("error",e,{type:"snackbar"})}function F(e){var i,n,c,l,r;if(!e||!e.url)return void a({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(o.isBlobURL)(e.url))return void z(e.url);z();let s,d=((e,t)=>{const{alt:a,id:i,link:n,caption:o}=e,c={alt:a,id:i,link:n,caption:o};return c.url=e.url,c})(e);var u,m;P.current&&!get(d,["caption"])&&(d=omit(d,["caption"])),s=e.id&&e.id===y?{url:k}:{width:void 0,height:void 0,sizeSlug:(u=e,m=M,u.hasOwnProperty("sizes")||u.hasOwnProperty("url")||u.hasOwnProperty("media_details")||u.hasOwnProperty("source_url")||void 0!==u[m]?M:"full")};let g,h=t.linkDestination;if(!h)switch((null===(i=wp)||void 0===i||null===(n=i.media)||void 0===n||null===(c=n.view)||void 0===c||null===(l=c.settings)||void 0===l||null===(r=l.defaultProps)||void 0===r?void 0:r.link)||"none"){case"file":case"media":h="media";break;case"post":case"attachment":h="attachment";break;case"custom":h="custom";break;case"none":h="none"}switch(h){case"media":g=e.url;break;case"attachment":g=e.link}d.href=g,a({...d,...s,linkDestination:h})}function A(e){e!==k&&a({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:M})}let D=((e,t)=>!e&&Object(o.isBlobURL)(t))(y,k);Object(r.useEffect)(()=>{if(!D)return;const e=getBlobByURL(k);e&&T({filesList:[e],onFileChange:([e])=>{F(e)},allowedTypes:R,onError:e=>{D=!1,I("error",e,{type:"snackbar"}),a({src:void 0,id:void 0,url:void 0})}})},[]),Object(r.useEffect)(()=>{D?z(k):Object(o.revokeBlobURL)(x)},[D,k]);const G=E(y,k)?k:void 0,J=!!k&&React.createElement("img",{alt:Object(m.__)("Edit image"),title:Object(m.__)("Edit image"),className:"edit-image-preview",src:k});Object(r.useEffect)(()=>{E(y,k)&&s&&!H&&window.fetch(k).then(e=>e.blob()).then(e=>U(e)).catch(()=>{})},[y,k,s,H]);const q=Object(u.useBlockProps)({ref:W});return React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},H&&React.createElement(c.ToolbarButton,{onClick:function(){T({filesList:[H],onFileChange([e]){F(e),Object(o.isBlobURL)(null==e?void 0:e.url)||(U(),I("success",Object(m.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:R,onError(e){I("error",e,{type:"snackbar"})}})},icon:d,label:Object(m.__)("Upload external image")})),React.createElement("figure",O({},q,{className:n()(i,"uagb-editor-preview-mode-"+L.toLowerCase(),"uagb-block-"+j,"wp-block-uagb-image-align-"+B)}),(x||k)&&React.createElement(w,{temporaryURL:x,attributes:t,setAttributes:a,isSelected:s,insertBlocksAfter:b,onReplace:v,onSelectImage:F,onSelectURL:A,onUploadError:N,containerRef:W,context:p,clientId:f,onCloseModal:V,onImageLoadError:function(e=!1){e||a({url:void 0,id:void 0})}}),!k&&React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:B,onChange:function(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};a({...t,align:e})}})),React.createElement(u.MediaPlaceholder,{icon:React.createElement(u.BlockIcon,{icon:h}),onSelect:F,onSelectURL:A,onError:N,onClose:V,accept:"image/*",allowedTypes:R,value:{id:y,src:G},mediaPreview:J,disableMediaButtons:x||k})))};j.propTypes={},j.defaultProps={},t.default=j}}]);